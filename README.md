# nHentai Downloader for LANraragi

A custom downloader plugin for [LANraragi](https://github.com/Difegue/LANraragi) designed to fetch galleries from nHentai using image scraping techniques.

## Features
- **Modern Scraper**: Built using `Mojo::UserAgent` for high-performance concurrent image downloading.
- **Session Sharing**: Automatically shares Cookies (`sessionid`, `cf_clearance`) and User-Agent settings from the built-in nHentai Metadata plugin.
- **Dynamic Detection**: Automatically detects image formats (JPG/PNG/WebP) and page counts.
- **Cloudflare Friendly**: Designed to work within the existing LRR browser session to minimize 503 errors.

## Requirements
- LANraragi v0.8.0 or higher.
- Correct Cookies set in the **nHentai Metadata Plugin** configuration.

## Installation

### 1. NixOS (Declarative Installation)
Add the following to your NixOS configuration:

```nix
let
  nhentaiPlugin = pkgs.fetchurl {
    url = "https://raw.githubusercontent.com/anton1615/lrr-plugin-nhentai/master/nHentai.pm";
    sha256 = "1b8255clh93580a37adq1sa4lj1hdm848ffp58gssh3rkxdc5928"; # Replace with actual hash
  };
in {
  virtualisation.oci-containers.containers.lanraragi.volumes = [
    "${nhentaiPlugin}:/home/koyomi/lanraragi/lib/LANraragi/Plugin/Download/nHentai.pm:ro"
  ];
}
```

### 2. Manual Installation
1. Download `nHentai.pm` from this repository.
2. Place it in the `/lib/LANraragi/Plugin/Download/` directory of your LANraragi installation.
3. Restart LANraragi.
4. Enable the plugin via **Configuration** -> **Plugins** -> **Downloader Plugins**.

## Technical Details
- **Developer**: Code automatically generated and optimized by **Gemini CLI Agent**.
- **Test Environment**: NixOS 25.11, LANraragi 0.9.60 (Docker).
- **Logic**: Parses the gallery index to extract Media ID and total pages, then generates direct image URLs for LRR's internal downloader.

## License
Licensed under the [MIT License](LICENSE).

---
*Generated by Gemini CLI Agent*
